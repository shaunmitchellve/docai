steps:
- name: 'gcr.io/cloud-builders/docker'
  id: build
  args:
  - build
  - -t
  - us-west1-docker.pkg.dev/$PROJECT_ID/$_ARTIFACT_NAME/file-processor
  - --build-arg
  - dataset=${_DATASET}
  - --build-arg
  - processorId=${_PROCESSOR_ID}
  - --build-arg
  - projectId=$PROJECT_ID
  - .
- name: 'gcr.io/cloud-builders/docker'
  id: push
  args:
  - push
  - us-west1-docker.pkg.dev/$PROJECT_ID/${_ARTIFACT_NAME}/file-processor
  waitFor:
    - build
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args:
  - run
  - deploy
  - document-processor
  - --image
  - us-west1-docker.pkg.dev/$PROJECT_ID/${_ARTIFACT_NAME}/file-processor
  - --region
  - ${_REGION}
  - --memory
  - 4G
  - --cpu
  - '2'
  waitFor:
    - push